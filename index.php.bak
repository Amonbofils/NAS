<?php
        //initialisation des variables de chemin
        // go debrid
        $godebrid = "/root/go/bin/";
        // torrent
        $torrent = "/home/benoit/torrent/";
        // jdownloader
        $jdownloader = "/opt/jdownloader/JDownloader.jar";


        //on rÃ©cupÃ¨re la liste des DL
        exec($godebrid."./go-debrid -l > phptorrents.txt");

        $filename = 'phptorrents.txt';
        if (file_exists($filename)){
                $lines = file($filename);
                foreach ($lines as $line_num => $line){
                                
                        if(mb_substr_count($line, "+")<10){
                                //on explose la ligne avec un sÃ©parateur |
                                $items = explode("|",$line);
                                // on  crÃ©Ã© un tableau d'index pour nommer les champs
                                if ($line_num==1) {
                                        
                                        foreach($items as $index => $item){
                                                $names[$index]=trim($item);
                                        }
                                } else {
                                        if ($line_num>1){
                                                foreach($items as $index => $item){
                                                        $dl_list[$line_num][$names[$index]]=trim($item);
                                                }
                                       
                                        }
                                }
                        }
                }
                //on a maintenant un tableau de DL, on va vÃ©rifier si le dl est terminÃ©, si oui, on va rÃ©cupÃ©rer l$
                            
                foreach($dl_list as $index => $dl){
                        if($dl['Status']=="finished"){
				$urlExplode = explode(",;,", $dl["Links"]);
				echo "count : ".count($urlExplode)."\n";
                                echo "dl num : $index est terminÃ©! son URL est ".str_replace(",;,","",$dl["Links"])." et son id est ".$dl['ID']." \n";                             
//                                exec("java -jar ".$jdownloader." -a ".str_replace(",;,","",$dl["Links"]));
                                // On supprime le fichier de la liste de alldebrid
  //                              exec($godebrid."./go-debrid -r ".$dl['ID']);
                        } else {
                                echo "pas terminÃ© \n";
                        }
                }
        } else {
                echo 'n\'existe pas !';
        }

        // on supprime le fichier texte
        //exec("rm test.txt");
?>

